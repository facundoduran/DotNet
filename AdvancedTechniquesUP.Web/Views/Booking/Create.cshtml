@model AdvancedTechniques.UP.Business.ViewModel.BookingViewModel
@{
    ViewBag.Title = "Create";
    var fromTime = DateTime.Now.ToString("dd/MM/yyyy HH:mm");
    var toTime = DateTime.Now.AddHours(1).ToString("dd/MM/yyyy HH:mm");       
}
@Scripts.Render("~/Scripts/bookingValidation")

@Scripts.Render("~/Scripts/signalRJs")
<script src="~/signalr/hubs"></script>

<div class="container">
    <div class="row">
      <div class="grid_8">
        <h2>Reserve Your Table</h2>
        <img src="@Url.Content("~/content/images/page3_img1.jpg")" alt="" class="img_inner fleft inn__1">
        <div class="extra_wrapper">
          <div class="text1 tx__1"><a href="#">Vivamus at magna non nunc </a></div>
          <p>Rehoncus. Aliquam nibh antegestas id ictum ado. Praesenterto faucibus maleada faucibusnec laeetert metus id laoreet </p>
          <p>Nullam consectetur orci sed nulla facilisisequaterto. Curabitur vel lorem sit amet nulla perermentum. Aliquam nibh ante, egestas id dictum a, commodo luctus libero.</p>
          Praesent faucibus malesuada faucibus. Donecertolin laoreet metus id laoreet malesuada.  orem ipsum dolor sit amet, consectetur adipiscing elit. 
        </div>
        <div class="clear"></div>
        <h2>Useful Information</h2>
        <div class="text1 tx__1"><a href="#">Hivamus at magna non nuncerto limonit nelowert sedrolino. Integer convallis orci vel miеter laoreet, at ornare lorem consequat. Phasellus erat nisl, auctor vel velit sed.</a></div>
        <p>Nehoncus. Aliquam nibh antegestas id ictum ado. Praesenterto faucibus maleada faucibusnec laeet metus id laoreet rolito monert dertolimon.</p>
        <p>Nullam consectetur orci sed nulla facilisisequat. Curabitur vel lorem sit amet nulla perermentum. Aliquam nibh ante, egestas id dictum a, commodo luctus libero. </p>
        <a href="#" class="btn">more</a>
      </div>
      <div class="grid_4">
        <h2>Our Hours</h2>
        <div class="form_title color1">
            <p id="offers"></p>
        </div>
        @using (Html.BeginForm("Create", "Booking", FormMethod.Post, new { @id = "bookingForm"}))
        {
            <div class="controlHolder">
              <div class="tmInput">
                  @Html.TextBoxFor(x => x.Customer.FirstName, new { id = "CustomerFirstName", @placeHolder = "First Name:" })
                  @{ Html.ValidateFor(x => x.Customer.FirstName); }
              </div>
            </div>

            <div class="controlHolder">
                <div class="tmInput">
                  @Html.TextBoxFor(x => x.Customer.LastName, new { id = "CustomerLastName", @placeHolder = "Last Name:" })
                  @{ Html.ValidateFor(x => x.Customer.LastName); }                
                </div>     
            </div>

            <div class="controlHolder">
                <div class="tmInput">
                  @Html.TextBoxFor(x => x.Customer.Telephone, new { id = "CustomerTelephone", @placeHolder = "Telephone:" })
                  @{ Html.ValidateFor(x => x.Customer.Telephone); } 
                </div>     
            </div>

            <div class="controlHolder">
                <div class="tmInput">
                  @Html.TextBoxFor(x => x.Customer.Email, new { id = "CustomerEmail", @placeHolder = "Email:" })
                  @{ Html.ValidateFor(x => x.Customer.Email); } 
                </div>     
            </div>

            <div class="clear f_sep1"></div>
            <strong class="dt">Check-in</strong>
            <div id="fromDateWidget" class="controlHolder">        
                <label class="tmDatepicker">
                    @Html.TextBoxFor(x => x.FromTime, new { id = "FromDate", @placeHolder = fromTime, @class = ".datetimePicker", @Value = fromTime})
                    @{ Html.ValidateFor(x => x.FromTime); } 
                </label>
            </div>

            <div class="clear"></div>

            <strong class="dt">Check-out</strong>
        
            <div id="toDateWidget" class="controlHolder">        
                <label class="tmDatepicker">
                    @Html.TextBoxFor(x => x.ToTime, new { id = "ToDate", @placeHolder = toTime, @class = ".datetimePicker", @Value = toTime})
                    @{ Html.ValidateFor(x => x.ToTime); } 
                </label>
            </div>
            <div class="clear"></div>

            <div class="controlHolder">
              <div class="tmInput">
                  @Html.TextBoxFor(x => x.DinersQuantity, new { id = "DinnersQuantity", @placeHolder = "Adults:" })
                  @{ Html.ValidateFor(x => x.DinersQuantity); } 
              </div>
            </div>

            <div class="clear"></div>
            <div class="ta__right">
            <a href="#" class="btn" data-type="reset">clear</a>
            <a href="#!" class="btn submitBooking" data-type="submit">send</a>
            </div>
        }
      </div>
    </div>
  </div>

<script type="text/javascript">

    $(document).ready(function () {

        var date = new Date();
        var minDate = new Date();
        var maxDate = new Date();
        minDate.setDate(date.getDate());
        maxDate.setDate(date.getDate() + 7);

        $('#FromDate').datetimepicker({
            format: 'DD/MM/YYYY HH:mm',
            minDate: minDate,
            pickDate: true,                 //en/disables the date picker
            pickTime: true,                 //en/disables the time picker
            useSeconds: false              //en/disables the seconds picker
        });
        

        $('#ToDate').datetimepicker({
            format: 'DD/MM/YYYY HH:mm',
            maxDate: maxDate,
            widgetParent: $('#toDateWidget'),
            pickDate: true,                 //en/disables the date picker
            pickTime: true,                 //en/disables the time picker
            useSeconds: false              //en/disables the seconds picker

        });

        var connection = $.connection.offersByDateHub;

        connection.client.getOffersByDate = function (offersCount) {
            debugger;
            $("#offers").text("Offers today :" + offersCount);
        };

        $.connection.hub.start()

        $(".submitBooking").click(function () {
            $.ajax({
                url: '/booking/Create',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({
                    "Customer.FirstName": $("#CustomerFirstName").val(),
                    "Customer.LastName": $("#CustomerLastName").val(),
                    "Customer.Telephone": $("#CustomerTelephone").val(),
                    "Customer.Email": $("#CustomerEmail").val(),
                    "FromTime": $("#FromDate").val(),
                    "ToTime": $("#ToDate").val(),
                    "DinersQuantity": $("#DinnersQuantity").val()
                }),
                dataType: "json",
                type: 'POST',
                success: function (data) {
                    connection.server.getOffersByDate();
                }
            });
        });
    });

</script>
